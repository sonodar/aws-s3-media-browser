# Implementation Plan

## Task 1. Lucide React アイコンライブラリの導入

- [x] 1.1 アイコンライブラリパッケージのインストール
  - npm で lucide-react をプロジェクトに追加
  - TypeScript 型定義が正しく認識されることを確認
  - ビルドが成功することを確認
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

---

## Task 2. ファイル種別判定の改善

- [x] 2.1 StorageItem 型と parseStorageItems の拡張
  - StorageItem 型に contentType プロパティを追加
  - S3ListItem インターフェースに contentType を追加
  - parseStorageItems で ListOutputItemWithPath.contentType を StorageItem にマッピング
  - _Requirements: 2.6_

- [x] 2.2 (P) fileTypes ユーティリティの拡張
  - contentType ベースの判定関数を追加（isImageContentType, isVideoContentType）
  - StorageItem を受け取る統合関数 getFileCategory を追加
  - contentType を優先し、未設定時は拡張子にフォールバック
  - 既存テストの更新と新規テストの追加
  - _Requirements: 2.6_

---

## Task 3. ファイル一覧画面のアイコン置き換え

- [x] 3.1 ファイル種別アイコンの実装
  - フォルダ、画像、動画、その他ファイルに対応したアイコンを表示
  - getFileCategory を使用して contentType ベースで判定
  - ファイル名と隣接するため装飾的アイコンとして aria-hidden 設定
  - 既存レイアウトとの整合性を維持するサイズ調整
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 6.2_

---

## Task 4. FABアクションボタンのアイコン置き換え

- [x] 4.1 (P) フォルダ作成・アップロード・閉じるボタンのアイコン実装
  - フォルダ作成ボタンにフォルダ追加アイコンを表示
  - アップロードボタンにアップロードアイコンを表示
  - モーダル閉じるボタンに X アイコンを表示
  - 既存の aria-label を維持しつつアイコンに aria-hidden 設定
  - FABサイズ（56px）に適したアイコンサイズ調整
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 6.2_

---

## Task 5. ドロップダウンメニューコンポーネントの作成

- [x] 5.1 汎用ドロップダウンメニュー機能の実装
  - メニューの開閉状態管理
  - 外部クリックでメニューを閉じる機能
  - Escape キーでメニューを閉じる機能
  - キーボードナビゲーション対応（Tab, Enter）
  - ARIA 属性の適切な設定（aria-haspopup, aria-expanded, role="menu", role="menuitem"）
  - _Requirements: 5.2, 5.5, 5.6, 5.7, 6.1, 6.3_

- [x] 5.2 ドロップダウンメニューのスタイリング
  - メニュー表示位置の調整
  - 視覚的なフィードバック（ホバー、フォーカス状態）
  - 危険なアクション用のスタイル（削除など）
  - _Requirements: 5.2, 5.3, 5.4_

---

## Task 6. ヘッダーナビゲーションのアイコン統合

- [x] 6.1 ナビゲーションボタンのアイコン化
  - 戻るボタンを矢印アイコンのみに変更
  - 削除ボタンをゴミ箱アイコンのみに変更（テキスト削除）
  - キャンセルボタンを X アイコンのみに変更（テキスト削除）
  - 選択モードボタンを複数選択アイコンのみに変更（テキスト削除）
  - 全選択/全解除ボタンをチェックボックスアイコンのみに変更
  - すべてのアイコンボタンに適切な aria-label を設定
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 6.1, 6.3_

- [x] 6.2 ハンバーガーメニューの統合
  - 設定・サインアウトボタンを削除
  - 縦3点リーダーアイコンのメニューボタンを追加
  - ドロップダウンメニュー経由で設定・サインアウト機能を提供
  - メニュー項目にアイコンとテキストラベルを表示
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

---

## Task 7. ファイルアクションメニューの実装

- [x] 7.1 ファイル/フォルダ操作メニューの作成
  - 各ファイル/フォルダアイテムに横3点リーダーアイコンを表示
  - リネームと削除のメニュー項目を提供
  - メニューオープン時に親要素のクリックイベントを阻止
  - 適切な aria-label の設定
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 6.1, 6.3_

- [x] 7.2 アクションメニューのインタラクション実装
  - 外部クリックとEscapeキーでメニューを閉じる
  - キーボードナビゲーション対応
  - リネームクリック時にリネームアクションをトリガー
  - 削除クリック時に削除アクションをトリガー
  - 最低 44x44px のタッチターゲットを確保
  - _Requirements: 8.5, 8.6, 8.7, 8.8, 8.9, 3.4_

---

## Task 8. [WANT] 3状態チェックボックスの実装

- [x] 8.1 全選択コントロールの3状態対応
  - 未選択時：空のチェックボックスアイコン
  - 部分選択時：マイナス付きチェックボックスアイコン
  - 全選択時：チェック済みチェックボックスアイコン
  - 選択状態に応じた aria-label の動的設定
  - _Requirements: 4.6_

---

## Task 9. スタイル調整とアクセシビリティ対応

- [x] 9.1 (P) アイコンスタイルの統一調整
  - 全コンポーネントでアイコンサイズの統一
  - アイコン色が currentColor を継承する設定
  - タッチターゲット（44px以上）の確保
  - _Requirements: 2.5, 3.4, 6.4_

- [x] 9.2 (P) アクセシビリティ属性の最終確認
  - 装飾アイコンに aria-hidden="true" が設定されていることを確認
  - 意味を伝えるアイコンに aria-label が設定されていることを確認
  - prefers-reduced-motion への対応確認
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

---

## Task 10. テストの更新と検証

- [x] 10.1 既存テストの互換性確認と更新
  - アイコン変更後も既存テストがパスすることを確認
  - 必要に応じてセレクタを aria-label や role ベースに更新
  - テストカバレッジが維持されていることを確認
  - _Requirements: 7.1, 7.2, 7.3_

- [x] 10.2 新規コンポーネントのテスト追加
  - ドロップダウンメニューの開閉・キーボード操作テスト
  - ファイルアクションメニューのクリックイベント・伝播阻止テスト
  - ハンバーガーメニューから設定・サインアウトが呼び出されるテスト
  - _Requirements: 7.1, 7.2, 7.3_

---

## Requirements Coverage Summary

| Requirement | Tasks                                  |
| ----------- | -------------------------------------- |
| 1.1-1.4     | 1.1                                    |
| 2.1-2.5     | 3.1                                    |
| 2.6         | 2.1, 2.2, 3.1                          |
| 3.1-3.4     | 4.1                                    |
| 4.1-4.5     | 6.1                                    |
| 4.6 [WANT]  | 8.1                                    |
| 5.1-5.7     | 5.1, 5.2, 6.2                          |
| 6.1-6.4     | 3.1, 4.1, 5.1, 6.1, 7.1, 7.2, 9.1, 9.2 |
| 7.1-7.3     | 10.1, 10.2                             |
| 8.1-8.9     | 7.1, 7.2                               |

## Implementation Order

1. Task 1 (Lucide React インストール) - 前提条件
2. Task 2 (ファイル種別判定の改善) - Task 1 完了後、Task 3 の前提
3. Task 3 (FileList アイコン) - Task 2 完了後
4. Task 4 (FAB アイコン) - 並列実行可能 (P)
5. Task 5 (DropdownMenu) - Task 6, 7 の前提
6. Task 6 (Header) - Task 5 完了後
7. Task 7 (FileActionMenu) - Task 5 完了後
8. Task 8 [WANT] (3状態チェックボックス) - Task 6 完了後
9. Task 9 (スタイル・アクセシビリティ) - 並列実行可能 (P)
10. Task 10 (テスト) - 全実装完了後
