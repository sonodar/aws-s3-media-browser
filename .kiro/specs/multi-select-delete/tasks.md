# Implementation Plan

## Task 1. useSelection フック実装 (P)

- [x] 1.1 (P) 選択状態管理の基本実装
  - 選択モード状態（有効/無効）の管理機能を実装する
  - 選択アイテムのキー集合を管理し、O(1)での選択チェックを可能にする
  - 選択モード開始・終了時の状態遷移を制御する
  - 選択モード終了時に選択状態を自動クリアする
  - _Requirements: 1.1, 1.3_

- [x] 1.2 (P) 選択操作関数の実装
  - 個別アイテムの選択状態をトグルする機能を実装する
  - 全アイテムの一括選択・解除を切り替える機能を実装する
  - 選択件数と全選択状態を導出する
  - 表示対象アイテム変更時に無効なキーを自動削除する
  - _Requirements: 2.1, 3.2, 3.3, 3.4_

- [x] 1.3 useSelection フックのユニットテスト
  - 選択モード切り替え、選択トグル、全選択/解除の動作検証
  - itemKeys 変更時の自動クリーンアップ検証
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4_

## Task 2. useStorageOperations 拡張（複数削除・フォルダ削除）(P)

- [x] 2.1 (P) 複数アイテム削除機能の実装
  - 複数のファイル・フォルダを受け取り一括削除する機能を実装する
  - 削除処理中の状態を管理し、UI への進捗表示に利用できるようにする
  - 部分失敗を許容し、成功・失敗を分離して結果を返す
  - 削除完了後にファイルリストを自動更新する
  - _Requirements: 4.3, 4.4, 4.5_

- [x] 2.2 (P) フォルダ再帰削除機能の実装
  - フォルダ選択時に配下のすべてのファイルとサブフォルダを取得する
  - 取得したコンテンツを並列で削除する
  - フォルダオブジェクト自体も削除対象に含める（フォルダオブジェクトが存在しない場合があることに注意）
  - _Requirements: 5.2, 5.3_

- [x] 2.3 useStorageOperations 拡張のユニットテスト
  - 単一/複数ファイル削除、フォルダ一括削除、部分失敗ハンドリングの検証
  - _Requirements: 4.3, 5.2, 5.3_

## Task 3. FileList 拡張（選択 UI）

- [x] 3.1 チェックボックス UI の実装
  - 選択モード時に各アイテムの左側にチェックボックスを表示する
  - チェックボックスのクリックで選択状態をトグルする
  - ファイルとフォルダの両方で選択可能にする
  - _Requirements: 1.2, 2.1, 2.4_
  - _依存: Task 1 完了後_

- [x] 3.2 (P) 選択状態の視覚的フィードバック
  - 選択中アイテムにハイライトスタイルを適用する
  - 選択解除時に通常スタイルに戻す
  - _Requirements: 2.2, 2.3, 6.3_

- [x] 3.3 (P) 選択モード時のクリック動作変更
  - 選択モード中はアイテムクリック時に選択トグルを行う
  - プレビューやフォルダ移動の動作を抑制する
  - _Requirements: 1.4_

- [x] 3.4 FileList 拡張のコンポーネントテスト
  - チェックボックス表示、選択状態ハイライト、クリック動作の検証
  - _Requirements: 1.2, 1.4, 2.1, 2.2, 2.3, 2.4, 6.3_

## Task 4. Header 拡張（選択モードツールバー）

- [x] 4.1 選択モードボタンの追加
  - 通常モード時に選択モード開始ボタンを表示する
  - ボタンクリックで選択モードを有効化する
  - _Requirements: 1.1_
  - _依存: Task 1 完了後_

- [x] 4.2 (P) 選択モードツールバーの実装
  - 選択モード時にキャンセル、件数表示、全選択、削除ボタンを表示する
  - 選択件数をリアルタイムで表示する
  - キャンセルボタンで選択モードを終了する
  - _Requirements: 1.3, 3.1, 6.1, 6.2_

- [x] 4.3 (P) 削除ボタンの有効/無効制御
  - 選択件数が 1 件以上の場合のみ削除ボタンを有効化する
  - 削除ボタンクリックで削除確認フローを開始する
  - _Requirements: 4.1_

- [x] 4.4 Header 拡張のコンポーネントテスト
  - 選択モードボタン、ツールバー表示、削除ボタン制御の検証
  - _Requirements: 1.1, 1.3, 3.1, 4.1, 6.1, 6.2_

## Task 5. DeleteConfirmDialog 拡張（複数削除確認）

- [x] 5.1 複数アイテム対応の確認メッセージ
  - 削除対象のアイテム数を確認ダイアログに表示する
  - 単一アイテムと複数アイテムで表示文言を切り替える
  - _Requirements: 4.2_
  - _依存: Task 2 完了後_

- [x] 5.2 (P) フォルダ削除時の警告表示
  - フォルダが含まれる場合に配下コンテンツも削除される旨の警告を表示する
  - ユーザーに明確なリスク提示を行う
  - _Requirements: 5.1_

- [x] 5.3 (P) 削除処理中の UI 状態
  - 削除処理中はボタンを無効化し「削除中...」を表示する
  - ユーザー操作をブロックして誤操作を防ぐ
  - _Requirements: 4.4_

- [x] 5.4 DeleteConfirmDialog 拡張のコンポーネントテスト
  - 複数アイテムメッセージ、フォルダ警告、削除中状態の検証
  - _Requirements: 4.2, 5.1_

## Task 6. MediaBrowser 統合

- [x] 6.1 選択機能の統合
  - useSelection フックを MediaBrowser に組み込む
  - FileList と Header に選択関連の props を渡す
  - 選択モードと通常モードで異なるアクションを表示する
  - _Requirements: 1.1, 1.3, 6.4_
  - _依存: Task 1, 3, 4 完了後_

- [x] 6.2 削除フローの実装
  - 削除ボタンクリック時に確認ダイアログを表示する
  - ユーザー承認後に useStorageOperations で削除を実行する
  - 削除処理中は進捗状態を表示し UI をブロックする
  - 削除完了後に選択モードを終了しリストを更新する
  - _Requirements: 4.2, 4.4, 4.5_
  - _依存: Task 2, 5 完了後_

- [x] 6.3 エラーハンドリング
  - 削除処理中のエラーをキャッチしてエラーメッセージを表示する
  - 失敗したアイテムをユーザーに通知する
  - 部分失敗時も成功分は反映してリストを更新する
  - _Requirements: 4.6_

- [x] 6.4 MediaBrowser 統合テスト
  - 選択モード開始→アイテム選択→削除確認→削除実行フローの検証
  - 部分失敗時のエラー表示フローの検証
  - _Requirements: 1.1, 1.3, 4.1, 4.2, 4.4, 4.5, 4.6, 6.4_

## Task 7. アクセシビリティ強化

- [x] 7.1 チェックボックスのアクセシビリティ
  - チェックボックスに適切な aria-label を設定する
  - キーボード（Space/Enter）でチェックボックスを操作可能にする
  - _Requirements: 7.1, 7.2_
  - _依存: Task 3 完了後_

- [x] 7.2 選択状態の通知
  - 選択件数の変更を aria-live 領域で通知する
  - スクリーンリーダーユーザーに選択状態を伝える
  - _Requirements: 7.3_
  - _依存: Task 4 完了後_

- [x] 7.3 削除ダイアログのフォーカス管理
  - ダイアログ表示時にフォーカストラップを実装する
  - ダイアログ外へのフォーカス移動を防ぐ
  - ダイアログ閉じる時に元の要素にフォーカスを戻す
  - _Requirements: 7.4_
  - _依存: Task 5 完了後_

- [x] 7.4 アクセシビリティテスト
  - aria-label、キーボード操作、aria-live 通知、フォーカストラップの検証
  - _Requirements: 7.1, 7.2, 7.3, 7.4_
