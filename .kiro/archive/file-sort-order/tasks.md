# Implementation Plan

## Tasks

- [x] 1. ソート順の型定義とロジック実装
- [x] 1.1 (P) ソート順の型と定数を定義する
  - 4種類のソート順（新しい順、古い順、名前順、サイズ順）を表す型を作成
  - 各ソート順に対応する日本語ラベルを定義
  - デフォルト値として「新しい順」を設定
  - _Requirements: 1.2, 2.3_

- [x] 1.2 (P) ソート関数を実装する
  - フォルダを常にファイルより先に表示するロジックを実装
  - フォルダ群・ファイル群それぞれに選択されたソート順を適用
  - 名前ソートでは数字を正しく扱う自然順ソートを使用
  - 日時ソートでは最終更新日時を基準にする
  - サイズソートではファイルサイズを基準に大きい順で並べる
  - 日時やサイズが未定義の場合のフォールバック処理を含める
  - _Requirements: 1.3, 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 1.3 ソート関数のユニットテストを作成する
  - 各ソート順で正しい順序になることを検証
  - フォルダ優先表示が維持されることを検証
  - 未定義フィールドのフォールバック動作を検証
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 2. ソート順の状態管理フック実装
- [x] 2.1 ソート順を管理するカスタムフックを実装する
  - 初期化時にローカルストレージから保存済みのソート順を読み込む
  - 保存されていない場合はデフォルト値を使用
  - ソート順変更時にローカルストレージに保存する
  - 不正な値が保存されている場合はデフォルト値にフォールバック
  - ローカルストレージが無効な環境でもエラーなく動作
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 2.2 フックのユニットテストを作成する
  - ローカルストレージへの保存・読み込みを検証
  - デフォルト値のフォールバックを検証
  - 不正な値からの復帰を検証
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 3. ソート選択UIコンポーネント実装
- [x] 3.1 ソート順を選択するドロップダウンコンポーネントを実装する
  - 4つのソートオプションを表示
  - 現在選択されているソート順を明示的に表示
  - キーボードで操作可能にする
  - スクリーンリーダー向けのARIAラベルを設定
  - _Requirements: 1.1, 1.2, 1.4, 4.2, 4.3_

- [x] 3.2 コンポーネントのスタイルを作成する
  - 既存のUIデザインと一貫性のあるスタイルを適用
  - ファイル一覧の上部に配置されるレイアウト
  - _Requirements: 4.1_

- [x] 3.3 コンポーネントのユニットテストを作成する
  - オプション選択時のコールバック呼び出しを検証
  - 現在のソート順が正しく表示されることを検証
  - _Requirements: 1.1, 1.4_

- [x] 4. メディアブラウザへの統合
- [x] 4.1 ソート機能をメディアブラウザに統合する
  - ソート順管理フックをメディアブラウザで使用
  - ソート選択コンポーネントをファイル一覧の上部に配置
  - ファイル一覧にソート関数を適用
  - ソート順変更時に即座にファイル一覧を再描画
  - _Requirements: 1.3, 4.1_

- [x] 4.2 統合テストを作成する
  - ソート順変更でファイル一覧の順序が変わることを検証
  - ページリロード後にソート順が復元されることを検証
  - _Requirements: 1.3, 2.2_
