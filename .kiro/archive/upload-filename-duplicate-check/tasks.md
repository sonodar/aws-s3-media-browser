# Implementation Plan

## Tasks

- [x] 1. 一意ファイル名生成ユーティリティの実装
- [x] 1.1 (P) 一意ファイル名生成関数の実装
  - 既存ファイル名リストを受け取り、重複しないファイル名を生成する純粋関数を作成
  - 重複がない場合は元のファイル名をそのまま返す
  - 重複がある場合は `ファイル名 (1).拡張子` 形式で連番を付与
  - 連番付きファイル名も存在する場合は次の連番を試行（2, 3, 4...）
  - 大文字小文字を区別してファイル名を比較
  - 生成されたファイル名が100文字を超える場合はエラーを返す
  - 拡張子がないファイル名にも対応（末尾に ` (N)` を追加）
  - _Requirements: 1.3, 2.1, 2.2, 2.3, 2.4, 2.5, 4.1_

- [x] 1.2 (P) 一意ファイル名生成関数のユニットテスト
  - 重複なし時は元のファイル名を返すことを検証
  - 重複あり時は連番付きファイル名を返すことを検証
  - 連番が既に存在する場合は次の連番を返すことを検証
  - 大文字小文字を区別することを検証
  - 長さ制限超過時はエラーを返すことを検証
  - 拡張子なしファイルの処理を検証
  - _Requirements: 1.3, 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 2. FileUploader への重複チェック統合
- [x] 2.1 FileActions に processFile コールバックを追加
  - FileUploader の processFile prop を使用してアップロード前にファイル名を処理
  - 現在フォルダ内の既存ファイル名リストを取得して重複をチェック
  - 重複検知時は一意ファイル名生成関数を呼び出してリネーム
  - 重複がない場合は元のファイル名のままアップロード
  - ファイル名生成エラー時は適切なエラーをスローしてアップロードを中止
  - 既存の items props から既存ファイル名リストを取得できるよう props を拡張
  - _Requirements: 1.1, 1.2, 3.1, 4.1, 4.2_

- [x] 2.2 MediaBrowser から FileActions への items 受け渡し
  - FileActions コンポーネントに items prop を追加
  - MediaBrowser から useStorageOperations の items を FileActions に渡す
  - processFile 内で items からファイル名リストを抽出して使用
  - _Requirements: 1.1_

- [x] 3. 統合テストと動作確認
- [x] 3.1 FileActions の統合テスト
  - processFile で重複ファイルがリネームされることを検証
  - 複数ファイル同時アップロード時に各ファイルで重複チェックが実行されることを検証
  - 重複なし時は元のファイル名のままアップロードされることを検証
  - ファイル名が長すぎる場合にエラーが表示されることを検証
  - _Requirements: 1.1, 1.2, 1.3, 2.1, 3.1, 3.4, 4.1_
